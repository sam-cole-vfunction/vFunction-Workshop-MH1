<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.111.3">
    <meta name="description" content="AWS Modernization Workshop vFunction AO">
<meta name="author" content="Sam Cole">

    <link rel="icon" href="https://awsmedia.s3.amazonaws.com/favicon.ico" type="image/x-icon" />

    <title>Config Data Source :: English</title>

    
    <link href="/css/nucleus.css?1697800351" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1697800351" rel="stylesheet">
    <link href="/css/hybrid.css?1697800351" rel="stylesheet">
    <link href="/css/featherlight.min.css?1697800351" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1697800351" rel="stylesheet">
    <link href="/css/auto-complete.css?1697800351" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1697800351" rel="stylesheet">
    <link href="/css/theme.css?1697800351" rel="stylesheet">
    <link href="/css/hugo-theme.css?1697800351" rel="stylesheet">
    
    <link href="/css/theme-mine.css?1697800351" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1697800351"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/200_refactoring-engine/210_servicecreation/5_db_config.html">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a href="/" title="Go home"><img style="vertical-align:middle;margin:1px;" src="../../images/vFunctionLogo_Vertical_FullColor_onDark_CMYK.png" height="125px">

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1697800351"></script>
<script type="text/javascript" src="/js/auto-complete.js?1697800351"></script>
<script type="text/javascript">
    
        var baseurl = "\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1697800351"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
      <li data-nav-id="/10_setup.html" title="Setup Environment" class="dd-item ">
        <a href="/10_setup.html">
        Setup Environment
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

          
          




 
  
    
    <li data-nav-id="/200_refactoring-engine.html" title="RE Tutorial" class="dd-item
        parent
        
        
        ">
      <a href="/200_refactoring-engine.html">
          RE Tutorial
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/1_import_baseline.html" title="Importing measurements" class="dd-item ">
        <a href="/200_refactoring-engine/1_import_baseline.html">
        Importing measurements
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/200_refactoring-engine/210_servicecreation.html" title="Service Creation" class="dd-item
        parent
        
        
        ">
      <a href="/200_refactoring-engine/210_servicecreation.html">
          Service Creation
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/210_servicecreation/1_dev_vm.html" title="Dev VM Content" class="dd-item ">
        <a href="/200_refactoring-engine/210_servicecreation/1_dev_vm.html">
        Dev VM Content
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/210_servicecreation/2_download_service_specs.html" title="Download service specs" class="dd-item ">
        <a href="/200_refactoring-engine/210_servicecreation/2_download_service_specs.html">
        Download service specs
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/210_servicecreation/3_code_copy.html" title="Code extraction" class="dd-item ">
        <a href="/200_refactoring-engine/210_servicecreation/3_code_copy.html">
        Code extraction
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/210_servicecreation/4_common_lib.html" title="Common library" class="dd-item ">
        <a href="/200_refactoring-engine/210_servicecreation/4_common_lib.html">
        Common library
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/210_servicecreation/5_db_config.html" title="Config Data Source" class="dd-item active">
        <a href="/200_refactoring-engine/210_servicecreation/5_db_config.html">
        Config Data Source
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/210_servicecreation/6_order_controller.html" title="Order Controller" class="dd-item ">
        <a href="/200_refactoring-engine/210_servicecreation/6_order_controller.html">
        Order Controller
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/210_servicecreation/7_inventory_controller.html" title="Inventory Controller" class="dd-item ">
        <a href="/200_refactoring-engine/210_servicecreation/7_inventory_controller.html">
        Inventory Controller
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/210_servicecreation/8_product_controller.html" title="Product Controller" class="dd-item ">
        <a href="/200_refactoring-engine/210_servicecreation/8_product_controller.html">
        Product Controller
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/210_servicecreation/9_summary.html" title="Summary" class="dd-item ">
        <a href="/200_refactoring-engine/210_servicecreation/9_summary.html">
        Summary
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/220_deployment.html" title="Deployment" class="dd-item ">
        <a href="/200_refactoring-engine/220_deployment.html">
        Deployment
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
      <li data-nav-id="/300_cleanup.html" title="Cleanup" class="dd-item ">
        <a href="/300_cleanup.html">
        Cleanup
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

          
          




 
  
    
      <li data-nav-id="/500_awsrefactorspaces.html" title="Appendix: AWS Refactor Spaces" class="dd-item ">
        <a href="/500_awsrefactorspaces.html">
        Appendix: AWS Refactor Spaces
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://awsworkshop.io"><i class='fas fa-graduation-cap'></i> Modernization Workshops</a>
              </li>
          
              <li>
                  <a class="padding" href="https://aws.amazon.com/blogs/modernizing-with-aws/"><i class='far fa-lightbulb'></i> Modernization with AWS</a>
              </li>
          
              <li>
                  <a class="padding" href="https://aws.amazon.com/marketplace/seller-profile?id=430fc1df-d408-4dcb-bfa4-1e84756cb963"><i class='fas fa-chalkboard-teacher'></i> vFunction on AWS Marketplace</a>
              </li>
          
              <li>
                  <a class="padding" href="http://www.vfunction.com/"><i class='fas fa-chalkboard-teacher'></i> vFunction Website</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      

      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>

    <a href="https://aws.amazon.com/privacy/?nc1=f_pr">Privacy</a> | <a
        href="https://aws.amazon.com/terms/?nc1=f_pr">Site Terms</a> | <a
        href="https://modernization-workshop-bucket.s3-us-west-2.amazonaws.com/license/cc-license.html">CC BY-SA 4.0</a>

</left>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Microservice Deployment: vFunction Refactoring Engine for AWS Workshop</a> > <a href='/200_refactoring-engine.html'>RE Tutorial</a> > <a href='/200_refactoring-engine/210_servicecreation.html'>Service Creation</a> > Config Data Source
          
        
          
        
          
        
          
        
                 
                  </span>
                </div>
                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
          <div id="chapter">
        
        <div id="body-inner">
          

        


<p><img src="/images/vFunction.png" alt="vFunction Logo"></p>
<h3 id="reconfiguring-the-services-data-source-from-spring-mvc-to-spring-boot">Reconfiguring the services data source from Spring MVC to Spring Boot</h3>
<p>The original application is a Spring Web MVC application, using a MySQL database running in Tomcat via JNDI (Java Naming and Directory Interface). The configuration is specified in spring-config.xml (src/main/resources folder) of the original application.</p>
<p>To switch from the JNDI based Spring MVC configuration to the Spring Boot configuration, we will need to do three steps for each of the services:</p>
<ol>
<li>Add a dependency to connect to MySQL DB to the <strong>pom.xml</strong> of the service</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-XML" data-lang="XML"><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;groupId&gt;</span>mysql<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;artifactId&gt;</span>mysql-connector-java<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;scope&gt;</span>runtime<span style="color:#f92672">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start="2">
<li>
<p><strong>Delete</strong> the XML elements <strong>src/main/resources/META-INF/rr/spring-config.xml</strong> in the resources/META-INF/rr directory (lines 9-39):</p>
<p>Starting from:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-XML" data-lang="XML"><span style="display:flex;"><span><span style="color:#f92672">&lt;jdbc:initialize-database</span> <span style="color:#a6e22e">data-source=</span><span style="color:#e6db74">&#34;dataSource&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;jdbc:script</span> <span style="color:#a6e22e">location=</span><span style="color:#e6db74">&#34;classpath:schema.sql&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/jdbc:initialize-database&gt;</span>
</span></span></code></pre></div><p>Ending with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-XML" data-lang="XML"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;tx:annotation-driven</span> <span style="color:#a6e22e">proxy-target-class=</span><span style="color:#e6db74">&#34;true&#34;</span> <span style="color:#a6e22e">transaction-manager=</span><span style="color:#e6db74">&#34;transactionManager&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.springframework.orm.jpa.JpaTransactionManager&#34;</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;transactionManager&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;entityManagerFactory&#34;</span> <span style="color:#a6e22e">ref=</span><span style="color:#e6db74">&#34;entityManagerFactory&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/bean&gt;</span>
</span></span></code></pre></div></li>
<li>
<p>Connect to the <strong>workshop-linux</strong> VM running the original application, and view the DB config file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo less /opt/tomcat/latest/webapps/oms-0.0.1-SNAPSHOT/META-INF/context.xml
</span></span></code></pre></div><p>The URL, username and password will be used in the next step.</p>
</li>
<li>
<p>Create an <strong>application.properties</strong> file under the folder <strong>src/main/resources</strong> with the following content:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#a6e22e">spring.datasource.url</span><span style="color:#f92672">=</span><span style="color:#e6db74">[url]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spring.datasource.driver-class-name</span> <span style="color:#f92672">=</span><span style="color:#e6db74">com.mysql.cj.jdbc.Driver</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spring.datasource.username</span><span style="color:#f92672">=</span><span style="color:#e6db74">[username]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spring.datasource.password</span><span style="color:#f92672">=</span><span style="color:#e6db74">[password]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">spring.jpa.hibernate.ddl-auto</span><span style="color:#f92672">=</span><span style="color:#e6db74">update</span>
</span></span></code></pre></div><p>Set the <strong>url, username</strong> and <strong>password</strong> (without the double quotes) according to the values in the application&rsquo;s context.xml above.</p>
<p>The URL should start with jdbc:mysql and end with ?createDatabaseIfNotExist=true; the rest should be omitted.</p>
<p>If the URL refers to localhost, then either replace it with the private ip of the Linux VM, or if you intend to deploy on EKS, replace the URL with the access point of the RDS service that was created for the workshop.</p>
<p>Example using the Linux DB: <code>jdbc:mysql://172.2.0.4:3307/oms1?createDatabaseIfNotExist=true</code></p>
<p>Example using the RDS DB:
<code>jdbc:mysql://workshop-mysql-o4o2kr.c6wk1jfk53qs.us-west-2.rds.amazonaws.com:3306/oms1?createDatabaseIfNotExist=true</code></p>
<p><strong>Make sure there are no white spaces after the values (e.g. for username and password)</strong></p>
<p>We will fine-tune these properties for each service in the following sections.</p>
</li>
</ol>
<p>
<div class="notices note" ><p>If you get an error opening  .properties files in Eclipse, right click on the .properties file and open it in a text editor (Open With…-&gt;Text Editor)</p>
</div>

<img src="/images/vFunction.png" alt="vFunction Logo"></p>


<footer class="footline">
	
</footer>

        
            </div> 
        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/200_refactoring-engine/210_servicecreation/4_common_lib.html" title="Common library"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/200_refactoring-engine/210_servicecreation/6_order_controller.html" title="Order Controller" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1697800351"></script>
    <script src="/js/perfect-scrollbar.min.js?1697800351"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1697800351"></script>
    <script src="/js/jquery.sticky.js?1697800351"></script>
    <script src="/js/featherlight.min.js?1697800351"></script>
    <script src="/js/highlight.pack.js?1697800351"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1697800351"></script>
    <script src="/js/learn.js?1697800351"></script>
    <script src="/js/hugo-learn.js?1697800351"></script>
    
        
            <script src="/mermaid/mermaid.js?1697800351"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

