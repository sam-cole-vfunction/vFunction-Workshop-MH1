<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.111.3">
    <meta name="description" content="AWS Modernization Workshop vFunction AO">
<meta name="author" content="Sam Cole">

    <link rel="icon" href="https://awsmedia.s3.amazonaws.com/favicon.ico" type="image/x-icon" />

    <title>Deployment :: English</title>

    
    <link href="/css/nucleus.css?1697800351" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1697800351" rel="stylesheet">
    <link href="/css/hybrid.css?1697800351" rel="stylesheet">
    <link href="/css/featherlight.min.css?1697800351" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1697800351" rel="stylesheet">
    <link href="/css/auto-complete.css?1697800351" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1697800351" rel="stylesheet">
    <link href="/css/theme.css?1697800351" rel="stylesheet">
    <link href="/css/hugo-theme.css?1697800351" rel="stylesheet">
    
    <link href="/css/theme-mine.css?1697800351" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1697800351"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/200_refactoring-engine/220_deployment.html">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a href="/" title="Go home"><img style="vertical-align:middle;margin:1px;" src="../../images/vFunctionLogo_Vertical_FullColor_onDark_CMYK.png" height="125px">

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1697800351"></script>
<script type="text/javascript" src="/js/auto-complete.js?1697800351"></script>
<script type="text/javascript">
    
        var baseurl = "\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1697800351"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
      <li data-nav-id="/10_setup.html" title="Setup Environment" class="dd-item ">
        <a href="/10_setup.html">
        Setup Environment
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

          
          




 
  
    
    <li data-nav-id="/200_refactoring-engine.html" title="RE Tutorial" class="dd-item
        parent
        
        
        ">
      <a href="/200_refactoring-engine.html">
          RE Tutorial
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/1_import_baseline.html" title="Importing measurements" class="dd-item ">
        <a href="/200_refactoring-engine/1_import_baseline.html">
        Importing measurements
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/200_refactoring-engine/210_servicecreation.html" title="Service Creation" class="dd-item
        
        
        
        ">
      <a href="/200_refactoring-engine/210_servicecreation.html">
          Service Creation
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/210_servicecreation/1_dev_vm.html" title="Dev VM Content" class="dd-item ">
        <a href="/200_refactoring-engine/210_servicecreation/1_dev_vm.html">
        Dev VM Content
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/210_servicecreation/2_download_service_specs.html" title="Download service specs" class="dd-item ">
        <a href="/200_refactoring-engine/210_servicecreation/2_download_service_specs.html">
        Download service specs
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/210_servicecreation/3_code_copy.html" title="Code extraction" class="dd-item ">
        <a href="/200_refactoring-engine/210_servicecreation/3_code_copy.html">
        Code extraction
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/210_servicecreation/4_common_lib.html" title="Common library" class="dd-item ">
        <a href="/200_refactoring-engine/210_servicecreation/4_common_lib.html">
        Common library
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/210_servicecreation/5_db_config.html" title="Config Data Source" class="dd-item ">
        <a href="/200_refactoring-engine/210_servicecreation/5_db_config.html">
        Config Data Source
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/210_servicecreation/6_order_controller.html" title="Order Controller" class="dd-item ">
        <a href="/200_refactoring-engine/210_servicecreation/6_order_controller.html">
        Order Controller
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/210_servicecreation/7_inventory_controller.html" title="Inventory Controller" class="dd-item ">
        <a href="/200_refactoring-engine/210_servicecreation/7_inventory_controller.html">
        Inventory Controller
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/210_servicecreation/8_product_controller.html" title="Product Controller" class="dd-item ">
        <a href="/200_refactoring-engine/210_servicecreation/8_product_controller.html">
        Product Controller
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/210_servicecreation/9_summary.html" title="Summary" class="dd-item ">
        <a href="/200_refactoring-engine/210_servicecreation/9_summary.html">
        Summary
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/200_refactoring-engine/220_deployment.html" title="Deployment" class="dd-item active">
        <a href="/200_refactoring-engine/220_deployment.html">
        Deployment
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
      <li data-nav-id="/300_cleanup.html" title="Cleanup" class="dd-item ">
        <a href="/300_cleanup.html">
        Cleanup
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

          
          




 
  
    
      <li data-nav-id="/500_awsrefactorspaces.html" title="Appendix: AWS Refactor Spaces" class="dd-item ">
        <a href="/500_awsrefactorspaces.html">
        Appendix: AWS Refactor Spaces
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://awsworkshop.io"><i class='fas fa-graduation-cap'></i> Modernization Workshops</a>
              </li>
          
              <li>
                  <a class="padding" href="https://aws.amazon.com/blogs/modernizing-with-aws/"><i class='far fa-lightbulb'></i> Modernization with AWS</a>
              </li>
          
              <li>
                  <a class="padding" href="https://aws.amazon.com/marketplace/seller-profile?id=430fc1df-d408-4dcb-bfa4-1e84756cb963"><i class='fas fa-chalkboard-teacher'></i> vFunction on AWS Marketplace</a>
              </li>
          
              <li>
                  <a class="padding" href="http://www.vfunction.com/"><i class='fas fa-chalkboard-teacher'></i> vFunction Website</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      

      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>

    <a href="https://aws.amazon.com/privacy/?nc1=f_pr">Privacy</a> | <a
        href="https://aws.amazon.com/terms/?nc1=f_pr">Site Terms</a> | <a
        href="https://modernization-workshop-bucket.s3-us-west-2.amazonaws.com/license/cc-license.html">CC BY-SA 4.0</a>

</left>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Microservice Deployment: vFunction Refactoring Engine for AWS Workshop</a> > <a href='/200_refactoring-engine.html'>RE Tutorial</a> > Deployment
          
        
          
        
          
        
                 
                  </span>
                </div>
                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
          <div id="chapter">
        
        <div id="body-inner">
          

        


<p><img src="/images/vFunction.png" alt="vFunction Logo"></p>
<h1 id="deployment-using-vfunction-deployment-tool">Deployment using vFunction Deployment Tool</h1>
<p>This section is an optional/advanced section intended for people with DevOps experience.</p>
<p>Also, you should skip ths section if you haven&rsquo;t set <strong>use_refactoring</strong> to true in <a href="/10_setup/_index.aws.html">Setup Environment</a> section.</p>
<p>After having working services, you can optionally deploy them to a micro-services environment such as a Kubernetes cluster or cloud service.</p>
<p>vFunction has an experimental tool to automate such a deployment.</p>
<h3 id="steps">Steps</h3>
<ol>
<li>
<p>Connect to the <em>workshop-linux</em> VM (via PuTTY)</p>
</li>
<li>
<p>cd to deployment tool folder</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd /opt/vfunction-packages/vfunction-refactoring-for-kubernetes
</span></span></code></pre></div></li>
<li>
<p>Review the configuration file</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>less config/installation.yaml
</span></span></code></pre></div><p>During the environment setup, the terraform has already configured the necessary settings such as the repo URL, username, password, nginx.</p>
<p>The services and the properties are also already configured under services:springBoot:services</p>
</li>
<li>
<p>Exit the configuration file (installation.yaml) and create the following folders (the names must match the names of the services in installation.yaml and in general, they must be all small letters with hyphens)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>    cd services
</span></span><span style="display:flex;"><span>    mkdir product-controller
</span></span><span style="display:flex;"><span>    mkdir inventory-controller
</span></span><span style="display:flex;"><span>    mkdir order-controller
</span></span></code></pre></div></li>
<li>
<p>Open Git Bash window</p>
</li>
<li>
<p>Go to the services folder</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cd /c/vFunctionLab/oms-services
</span></span></code></pre></div></li>
<li>
<p>Set an environment variable for the IP address of the <em>workshop-linux</em> machine</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>LINUXVMIP<span style="color:#f92672">=[</span>the IP address of workshop Linux VM<span style="color:#f92672">]</span>
</span></span></code></pre></div></li>
<li>
<p>Copy order-controller</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>scp ./order-controller/target/OrderController-1.0-SNAPSHOT.jar workshop@$LINUXVMIP:/opt/vfunction-packages/vfunction-refactoring-for-kubernetes/services/order-controller
</span></span></code></pre></div><p>Enter the password (vFunction2021!) when prompted</p>
<p>Note: If scp fails because the remote certification has changed, then delete c:\Users\workshop.ssh (the entire folder) and try again</p>
</li>
<li>
<p>Similarly copy inventory controller</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>scp ./inventory-controller/target/InventoryController-1.0-SNAPSHOT.jar workshop@$LINUXVMIP:/opt/vfunction-packages/vfunction-refactoring-for-kubernetes/services/inventory-controller
</span></span></code></pre></div><p>And product controller:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>scp ./product-controller/target/ProductController-1.0-SNAPSHOT.jar workshop@$LINUXVMIP:/opt/vfunction-packages/vfunction-refactoring-for-kubernetes/services/product-controller 
</span></span></code></pre></div></li>
<li>
<p>Go back to the <em>workshop-linux</em> VM (PuTTY) and do <code>cd /opt/vfunction-packages/vfunction-refactoring-for-kubernetes</code></p>
</li>
<li>
<p>Since the ECR password is valid only for 24 hours, refresh it in the configuration by running:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bash ./aws-refresh-ecr-token.sh
</span></span></code></pre></div></li>
<li>
<p>Run the installer</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo bash install.sh -n vfunction -b
</span></span></code></pre></div><pre><code>The last output messages of the script should look *similar* to:

```text
Wait for all service pods to run in namespace vfunction and then access the services with the following FQDNs:
    product-controller -&gt; a2ac33ccf24a245bd9891679063fd3a5-840504988.us-west-2.elb.amazonaws.com/product-controller/
    inventory-controller -&gt; a2ac33ccf24a245bd9891679063fd3a5-840504988.us-west-2.elb.amazonaws.com/inventory-controller/
    order-controller -&gt; a2ac33ccf24a245bd9891679063fd3a5-840504988.us-west-2.elb.amazonaws.com/order-controller/
```

Copy the FQDN somewhere for later use (e.g., copy them to a notepad)
</code></pre>
<ol start="12">
<li>
<p>Go to the AWS console and open the EKS service (in the same region as the EC2 instances) with the name starting with workshop_eks and review the workloads. You should see three workloads corresponding to the three services with namespace vfunction and they should be in the Ready state.</p>
<p><img src="/images/EKS-Deployed-Services.png" alt="EKS Deployed Services">
You can also review the ECR and see three repositories corresponding to the three services.</p>
</li>
<li>
<p>Open postman and test the calls to the various services by replacing the hostname from localhost:8080 with the corresponding FQDNs above. Below is an example screenshot (note the URL):</p>
<p><img src="/images/Postman-KubDeployed-AWS.png" alt="Postman Deployed"></p>
<p><em>Note: Some API calls of the product controller return internal server error (500). Can you think why and how to fix it? (hint: service to service dependency)</em></p>
</li>
<li>
<p>Now that we have three services deployed to EKS, we can use <a href="https://aws.amazon.com/migration-hub/features/#Incremental_app_refactoring">AWS Migration Hub Refactor Spaces</a> to redirect calls from the OMS original application to the services. If you are interested in trying this out, do <!-- raw HTML omitted -->this Appendix<!-- raw HTML omitted --> before proceeding to Cleanup.</p>
</li>
</ol>
<p><img src="/images/vFunction.png" alt="vFunction Logo"></p>


<footer class="footline">
	
</footer>

        
            </div> 
        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/200_refactoring-engine/210_servicecreation/9_summary.html" title="Summary"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/300_cleanup.html" title="Cleanup" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1697800351"></script>
    <script src="/js/perfect-scrollbar.min.js?1697800351"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1697800351"></script>
    <script src="/js/jquery.sticky.js?1697800351"></script>
    <script src="/js/featherlight.min.js?1697800351"></script>
    <script src="/js/highlight.pack.js?1697800351"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1697800351"></script>
    <script src="/js/learn.js?1697800351"></script>
    <script src="/js/hugo-learn.js?1697800351"></script>
    
        
            <script src="/mermaid/mermaid.js?1697800351"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

